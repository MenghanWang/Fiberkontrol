--------Preprocessing files---------
**********************************************************************************
**Steps for converting raw data (in .npz format as output by fiberkontrol_LED.py)*
**into flattened data in an hdf5 file, ready for analysis.			 *
**********************************************************************************

1) Make sure that data files have the format:
20121105-GC5-homecagesocial-8497-600patch-2012_11_5_19-6_run_number_0.npz

and complete filenames like:
'/Users/isaackauvar/Dropbox/Fiberkontrol/Fiberkontrol_Data/Lisa_Data/20121105/20121105-GC5-homecagesocial-8497-600patch-2012_11_5_19-6_run_number_0.npz'


2) Add all filenames to the file
      analysis_filenames.txt
   in the Fiberkontrol/code/analysis directory
   You can always adjust the directory the files with a search and replace all    command in analysis_filesnames.txt

3) To flatten data: run

python preprocessing.py --save-debleach -f analysis_filenames.txt

# Deprecated 4) Populate folders titled Flat/ 
#   		for each day of the trial
#   		based on the plots in Debleach/

4) Populate a single folder title Flat/ with the flat
	npz files of all data to be used

5) Run

python preprocessing.py 'path_to_npz' --generate-hdf5 -f analysis_filenames.txt -o 'path_to_hdf5'

# Deprecated 6) Make sure that experiment_dates.txt contains
# 	        all the dates of all experiments you desire to include

7) Run

#deprecated:
#python preprocessing.py 'path_to_npz' --add-flattened-files -f analysis_filenames.txt -d experiment_dates.txt -o 'path_to_hdf5'

python preprocessing.py 'path_to_npz' --add-flattened-files -f analysis_filenames.txt -o 'path_to_hdf5' --path-to-flat-data 'path_to_folder_with_flat_data'


8) Now you should have a single hdf5 file that contains both the original
   raw data stored in 'time_series_arr', which has the fluorescence data,
   the trigger data, and the time stamps. Additionally in 'flat' data
   is the flattened data (still in raw normalization format) 

------------Analyzing files------------
**See the script make_figures.sh for examples**

-----------Testing script-------------
Change the hardcoded paths in tests/test_configuration.json

in the command line type:
nosetests -v

If you need to generate more test data, see the examples in generate_test_data.sh
However, be sure not to rerun the script for the already existing data, since 
mice 0001 through 0004 have a stochastic component and the tests may not pass
if the data is regenerated.
